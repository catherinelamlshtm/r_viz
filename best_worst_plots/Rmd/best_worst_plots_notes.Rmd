---
title: "Notes on Tufte's principles"
author: "Sam Clifford"
date: '2019-11-08'
citation_package: natbib
bibliography: extras.bib
csl: chicago-author-date.csl
output: 
  pdf_document:
    includes:
      in_header: matrix.tex
---

```{r global_options, include=FALSE}
library(knitr)
library(ggplot2)
library(ggthemes)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE, collapse=T, warning=F, message=F, tidy=FALSE, fig.width = 4, fig.height=2)
```

# Tufte's principles for visualising data

## A quick tour

* Visual representations of data must tell the truth
* Good graphical representations maximize data-ink and erase as much non-data-ink as possible
* Avoid chartjunk: the excessive and unnecessary use of graphical effects in graphs
* Produce high data density graphs

## Graphical integrity

Visual representations of data must tell the truth


``` {r fig.margin=T, echo=F, fig.cap="Improper emphasis of most and least fuel efficient cars. We only need look at vertical range to see these are the min and max"}
data(mtcars)
ggplot(data=mtcars, aes(x=factor(cyl), y=mpg)) +
  geom_point(alpha=0.5) +
  geom_point(data=mtcars %>%
               mutate(model=row.names(.)) %>%
               arrange(., mpg) %>%
               filter(mpg %in% range(mpg)), 
               size=4, alpha=0.5 , pch=1, color="red") +
  theme_bw() +
  xlab("Cylinders") +
  ylab("Fuel efficiency (mpg)")
```

1. The visual representation of numbers, as physically measured on the graph, should be directly proportional to the numerical quantities represented
    - Lie Factor = the size of the effect shown in the graphic divided by the size of the effect in the data.
    - Values over 1 overstate the effect & under 1 understate. 
    - Don't make points bigger to emphasise them as important



2. Clear, detailed and thorough labelling helps avoid graphical distortion and ambiguity.  Write explanations of data on the graph.  Label important events from data.
3. Show variation through data, not through design.
4. Ensure appropriate standardization & comparisons are used, e.g.  CPI-adjusted or seasonally-adjusted.

``` {r fig.margin=T, echo=F, fig.cap="Fuel efficiency mapped to colour and y coordinate. Gradated pattern of colour implies there's another relationship with fuel efficiency being looked at.", fig.height=4, fig.width=6}
data(mtcars)
ggplot(data=mtcars, aes(x=wt, y=mpg)) +
  geom_point(aes(shape=factor(cyl),
             color=mpg),
              stroke=0, alpha=0.75, size=2) + 
  #facet_wrap( ~ cyl, ncol=1) +
  theme_bw() +
  theme(legend.position = "right") +
  scale_shape_discrete(name="Number\nof\ncylinders") +
  xlab("Weight (1000 lbs)") +
  ylab("Fuel efficiency (mpg)") + 
  scale_color_gradient(low = "red",
                       high="blue",name="Fuel\n efficiency\n (mpg)") +
  guides(col = guide_legend(ncol = 1),
         shape = guide_legend())
```

5. The number of information carrying (variable) dimensions depicted should not exceed the number of dimensions in the data.
    - In practice, this means not mapping the same variable to two graphical elements
6. Graphics must not quote data out of context.


## Maximising `data:ink` ratio

Good graphical representations maximize data-ink and erase as much non-data-ink as possible

1. Above all else, show data
2. Maximise the data-ink ratio
    - ink on a graph that represents data
    - data-ink ratio = 1 minus the proportion of the graph that can be erased without loss of data-information
3. Erase non-data-ink
4. Erase redundant data-ink
5. Revise and edit

``` {r fig.margin=T, fig.cap="Standard boxplot", echo=F}
data(mtcars)

ggplot(data=mtcars, aes(x=factor(cyl), y=mpg)) +
  geom_boxplot() + theme_bw() +
  xlab("Number of cylinders") +
  ylab("Fuel efficiency (mpg)") 
```

``` {r fig.margin=T, fig.cap="Tufte-compliant boxplot maximising data ink", echo=F, fig.height=2, fig.width=4}
data(mtcars)

ggplot(data=mtcars, aes(x=factor(cyl), y=mpg)) +
  geom_tufteboxplot() + theme_tufte() +
  xlab("Number of\ncylinders") +
  ylab("Fuel efficiency (mpg)") +
  coord_flip()
```

## Avoid Chartjunk

If an element of a graph is to be included, it should be because it aids understanding and reveals information, not because it looks pretty

* Examples of chartjunk include but are not restricted to:
    - hatching (patterns instead of colours)
    - heavy grids
    - equally spaced lines, too close together, as in bar charts, histograms, boxplots
    - self-promoting graphs that demonstrate the graphical ability of the designer rather than displaying the data
    - 3D graphics that distort perspective (e.g. 3D pie charts)
    
## Maximising data density

   
``` {r, echo=F, fig.cap="High dimensional data set with points coloured by number of forward gears and shape mapped to transmission type", fig.margin=T, fig.width=4, fig.height=2.5}
mtcars %>%
  mutate(am = c("Automatic", "Manual")[am + 1],
         vs = c("V", "S")[vs + 1]) %>%
  ggplot(data=., aes(x=factor(cyl),
                    y=mpg)) +
  geom_point(aes(color=factor(gear),
                 shape=am)) +
  scale_color_discrete(name="Gears") +
  scale_shape(name="Transmission") +
  theme_bw() +
  theme(legend.position='right') +
  xlab("Cylinders") +
  ylab("Fuel efficiency (mpg)")
  
```


``` {r, echo=F, fig.cap="High dimensional data set with small multiples faceting by number of forward gears and transmission type", fig.margin=T, fig.height=2.5, fig.width=4}
mtcars %>%
  mutate(am = c("Automatic", "Manual")[am + 1],
         vs = c("V", "S")[vs + 1]) %>%
  ggplot(data=., aes(x=factor(cyl),
                    y=mpg)) +
  geom_point() +
  facet_grid(am ~ gear) +
  theme_bw() +
  xlab("Number of cylinders") +
  ylab("Fuel efficiency (mpg)")
```

1. Maximise data density and the amount of data shown, within reason
2. Apply the shrink principle
    - most graphs can be shrunk down very far without losing legibility or information
    - this is because most graphs are quite sparse
3. Exploit **small multiples** to provide for comparisons across groups
    - series of the same small graph repeated in one visual
    - can compare a main relationship across one or more grouping variables
    - a great way to visualise large quantities of data, or when there are a high number of dimensions
 
# Aesthetics in ggplot2

## Inheriting aesthetics

In the lecture we show how the following code takes the variables `my.x.variable` and `my.y.variable` from the data frame `my.data.frame`, maps them to the $x$ and $y$ coordinates on a set of axes and then draws the pairs of $x$ and $y$ as points.

``` {r, eval=F, echo=T}
ggplot(data = my.data.frame, 
       aes(x = my.x.variable,
           y = my.y.variable)) +
  geom_point()
```

In addition to default settings about how to draw points, the `geom_point()` call has inherited the `x` and `y` aesthetics from the `ggplot()` call that forms the basis of the plot. We could have also written this plot as:

``` {r, eval=F, echo=T}
ggplot(data = my.data.frame) +
  geom_point(aes(x = my.x.variable,
                 y = my.y.variable))
```

or even

``` {r, eval=F, echo=T}
ggplot() +
  geom_point(data = my.data.frame,
             aes(x = my.x.variable,
                 y = my.y.variable))
```

and we get the exact same plot in each case.

However, as we add more and more geometries to our plot it becomes tiresome, and easy to make a mistake, to continue putting the exact same aesthetics in the call for every single geometry. In practice, it's easiest to think about which aesthetics will be common to all (or nearly all) geometries in a plot and put those in the initial `ggplot()` call. Within the geometry we can add additional aesthetic options, e.g.

``` {r, eval=F, echo=T}
ggplot(data = my.data.frame, 
       aes(x = my.x.variable,
           y = my.y.variable)) +
  geom_point(aes(color = my.color.variable))
```

or overwrite what is being inherited with something else

``` {r, eval=F, echo=T}
ggplot(data = my.data.frame, 
       aes(x = my.x.variable,
           y = my.y.variable)) +
  geom_point() +
  geom_line(aes(y = my.prediction.from.a.linear.model))
```

## Other plotting aesthetics

We can pass many other arguments in `ggplot2` to change things about the geometries we use to show the $x$ and $y$ variables. If we put these aesthetics outside the `aes()` statement, this will make this option constant for the entire geometry, e.g. `geom_point(color = "red")` will make all of these points red. Alternatively, we can map a variable in the data frame to one of the following aesthestics:

- **group** to repeat geometry for a grouping variable, an alternative to calling `lines()` in base plotting within a loop that subsets the data frame
- **size** of point or thickness of boundary
- **shape** of points
- **colour** of boundary (for most point shapes, the entire point is the boundary)
- **alpha** transparency
- **fill** colour of internals of geometry

Below we look at some examples of changing one or more of these.

### Group

Instead of splitting all data up with small multiples, we could use grouping to show each each group on a common set of axes. This is especially useful when we have many, many groups in the data set

``` {r, fig.height=2, fig.width=6, eval=T, echo=T, out.width="100%"}
library(ElemStatLearn)
data(bone)

ggplot(data = bone, aes(x = age, y = spnbmd)) +
  geom_point(alpha=0.1) + facet_wrap(~ gender) +
  geom_line(aes(group = idnum)) +  theme_bw() +
  labs(x = "Age (years)", y = expression(Rel.~BMD~(g~cm^{-3}~yr^{-1})),
       title = "Relative spinal bone mineral density")

```
  
### Colour and fill


``` {r, eval=T, echo=T, fig.height=2, fig.width=6, message=F, out.width="100%"}
ggplot(data = airquality, aes(x = Ozone)) +  
  geom_histogram(binwidth = 10, boundary = 0,
                 fill = "lightskyblue", color = "black") +  
  labs(x = "Ozone concentration (ppb)") +
  theme_bw() + facet_wrap(~Month, nrow = 1)
```

### Size and shape


``` {r, fig.height=6, fig.width=6, eval=T, echo=T, out.width="100%"}
ggplot(data = airquality, aes(x = Solar.R, y = Temp)) + theme_bw() +
  geom_point(aes(size = Ozone, shape = factor(Month))) +
  theme(legend.position = "bottom",
        legend.box = "vertical") +
  scale_size_area(name = "Ozone concentration (ppb)") +
  scale_shape(name = "Month") + 
  labs(x = "Solar radiation (Langleys)",
       y = expression(Max.~daily~temp.~(degree*F)))
   
```

We must be careful when using shape that we do not choose to use a variable that has so many levels that it becomes too taxing for the reader to tell which is which. Thankfully, ggplot2 gives us some warning when try to do something stupid and use too many.

### Alpha transparency

Alpha refers to the transparency (1 = solid, 0 = fully transparent). This is useful when you've got lots of things stacked on top of each other in a plot and want to make it clear how many of them there are, or you're using an overlay.

``` {r, echo=T, message=F, fig.width=6, fig.height=2.5, out.width="100%"}
ggplot(data = airquality, aes(x = Solar.R, y = Temp)) + theme_bw() +
  geom_point(alpha = 0.25) + theme(legend.position = "bottom") +
  geom_smooth() +
  labs(x = "Solar radiation (Langleys)",
       y = expression(Max.~daily~temp.~(degree*F)))
```

### Shape

* Can change point shape to help identify grouping
* Most useful when there's only a few groups


``` {r, echo=T, message=F, fig.width=4, fig.height=2}
data(mtcars)
ggplot(data=mtcars, aes(x=wt, y=mpg)) +
  geom_point(aes(shape=factor(am))) + theme_bw() +
  xlab("Weight (1000lbs)") + ylab("Fuel efficiency (mpg)") +
  geom_smooth(method = "lm")
```

### Changing the default options

Many `scale_*` functions allow us to set options for the relevant aesthetic and corresponding legend name, e.g.

* `scale_color_gradient()` makes a color gradient for when we use `aes(color=...)`
* `scale_fill_brewer()` sets a color palette for `aes(fill=...)` using colour schemes at http://colorbrewer2.org/
* `scale_shape(name = "Transmission", ...)` changes the title from "factor(am)" to "Transmission" for `aes(shape=factor(am))` in the previous slide
* `scale_x_log10()` changes the $x$ axis to have a logarithmic scale in increasing powers of 10.
* Find more at the [`ggplot2` documentation page](http://ggplot2.tidyverse.org/reference/)




# References
